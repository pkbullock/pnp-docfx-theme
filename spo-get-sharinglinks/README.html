<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>

  <head>
    <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <title>Get sharing links within the tenant | PnP Modern Theme for DocFx Sites </title>
      <meta name="viewport" content="width=device-width">
      <meta name="title" content="Get sharing links within the tenant | PnP Modern Theme for DocFx Sites ">
    <meta name="description" content="A sample gallery for all things Microsoft 365.">
    
      <link rel="shortcut icon" href="../https://c.s-microsoft.com/favicon.ico?v2">
      <link rel="stylesheet" href="../styles/docfx.vendor.min.css">
      <link rel="stylesheet" href="../styles/docfx.css">
      <link rel="stylesheet" href="../styles/main.css">

      <link rel="stylesheet" href="../styles/styles.css">
      <link rel="stylesheet" href="../styles/custom.css">
      <link rel="prefetch" href="../images/base-assets.svg" as="image" type="image/svg+xml" media="all">
      <!-- Made with ❤️ by the PnP team -->
      <!-- Design: Stefan Bauer (https://n8d.at/)-->
      <!-- DocFx Theme by: Paul Bullock (https://pkbullock.com/)-->
      <!-- Inspiration of site: Hugo Bernier (https://tahoeninja.blog/)-->

      <meta property="docfx:navrel" content="../toc.html">
      <meta property="docfx:tocrel" content="../toc.html">
    
    
    <meta property="docfx:newtab" content="true">

      <!-- Insert Clarity Header Here - set as property in DocFx config file -->


  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120" class="pnp-backdrop">
    <div id="wrapper" class="wrapper">
      <header class="page-header">


        <a href="../index.html" class="site-logo-link">
          <div class="site-logo">
            <span class="u-nowrap">Microsoft 365 &amp Power</span><br>
            <span class="u-nowrap ff-pp">Platform Community</span><br>
            <span class="u-nowrap ff-com">Script Samples</span><br>
          </div>
        </a>
        <nav class="nav">
           <button class="hamburger" tabindex="-1">
              <svg class="active">
                <title id="ham-title-active">Click to close - Hamburger in form of arrows</title>
                <use xlink:href="../../images/base-assets.svg#hamburger"></use>
              </svg>
              <svg class="inactive">
                <title id="ham-title-inactive">Click to open - Hamburger in form of three stripes</title>
                <use xlink:href="../../images/base-assets.svg#hamburger-inactive"></use>
              </svg>
            </button>
            <!--<div class="collapse navbar-collapse" id="navbar">-->
            <div class="" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div> 
        </nav>      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="article row grid">
          <div class="col-md-12">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="get-sharing-links-within-the-tenant">Get sharing links within the tenant</h1>

<h2 id="summary">Summary</h2>
<p>Effective oversight of sharing links is paramount to ensuring data security, compliance, and optimal collaboration experiences.</p>
<p>For Copilot for M365 implementations, ensuring there is no oversharing is a critical aspect of safeguarding sensitive information and maintaining regulatory compliance. By integrating the sharing link audit process into deployment strategies, administrators can preemptively address security vulnerabilities and uphold the integrity of M365 environments.</p>
<p><img src="assets/preview.png" alt="Example Screenshot"></p>
<h3 id="prerequisites">Prerequisites</h3>
<ul>
<li>The user account that runs the script must have SharePoint Online tenant administrator access.</li>
</ul>
<div class="tabGroup" id="tabgroup_1">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_1_pnpps" role="tab" aria-controls="tabpanel_1_pnpps" data-tab="pnpps" tabindex="0" aria-selected="true">PnP PowerShell</a>
</li>
</ul>
<section id="tabpanel_1_pnpps" role="tabpanel" data-tab="pnpps">

<pre><code class="lang-powershell">#Parameters
$tenantUrl = Read-Host -Prompt &quot;Enter tenant collection URL&quot;;
$dateTime = (Get-Date).toString(&quot;dd-MM-yyyy-hh-ss&quot;)
$invocation = (Get-Variable MyInvocation).Value
$directorypath = Split-Path $invocation.MyCommand.Path
$fileName = &quot;SharedLinks-&quot; + $dateTime + &quot;.csv&quot;
$ReportOutput = $directorypath + &quot;\Logs\&quot;+ $fileName

#Connect to PnP Online
Connect-PnPOnline -Url $tenantUrl -Interactive

$global:Results = @();

function getSharingLink($_ctx,$_object,$_type,$_siteUrl,$_listUrl)
{
    $SharingInfo = [Microsoft.SharePoint.Client.ObjectSharingInformation]::GetObjectSharingInformation($_ctx, $_object, $false, $false, $false, $true, $true, $true, $true)
        $ctx.Load($SharingInfo)
        $ctx.ExecuteQuery()
        ForEach($ShareLink in $SharingInfo.SharingLinks)
        {
            If($ShareLink.Url)
            {           
                If($ShareLink.IsEditLink)
                {
                    $AccessType=&quot;Edit&quot;
                }
                ElseIf($shareLink.IsReviewLink)
                {
                    $AccessType=&quot;Review&quot;
                }
                Else
                {
                    $AccessType=&quot;ViewOnly&quot;
                }
                #Collect the data

                if($_type -eq &quot;File&quot;)
                {
                  $ObjectType = $item.FileSystemObjectType; 
                  $Name  = $Item.FieldValues[&quot;FileLeafRef&quot;]           
                  $RelativeURL = $Item.FieldValues[&quot;FileRef&quot;]
                }
                else
                {
                    $ObjectType = $_type;
                    $Name = &quot;&quot;;
                    $RelativeURL = $listUrl ?? $SiteUrl;
                }
                $result = New-Object PSObject -property $([ordered]@{
                    SiteUrl = $SiteURL
                    listUrl = $listUrl
                    Name  = $Name           
                    RelativeURL = $RelativeURL
                    ObjectType = $ObjectType
                    ShareLink  = $ShareLink.Url
                    ShareLinkAccess  =  $AccessType
                    HasExternalGuestInvitees = $ShareLink.HasExternalGuestInvitees
                    ShareLinkType  = $ShareLink.LinkKind
                    AllowsAnonymousAccess  = $ShareLink.AllowsAnonymousAccess
                    IsActive  = $ShareLink.IsActive
                    Expiration = $ShareLink.Expiration
                })
                $global:Results +=$result;
            }
        }
}

#Exclude certain libraries
$ExcludedLists = @(&quot;Form Templates&quot;, &quot;Preservation Hold Library&quot;, &quot;Site Assets&quot;, &quot;Images&quot;, &quot;Pages&quot;, &quot;Settings&quot;, &quot;Videos&quot;,&quot;Timesheet&quot;
    &quot;Site Collection Documents&quot;, &quot;Site Collection Images&quot;, &quot;Style Library&quot;, &quot;AppPages&quot;, &quot;Apps for SharePoint&quot;, &quot;Apps for Office&quot;)

$m365Sites = Get-PnPTenantSite| Where-Object { ( $_.Url -like '*/sites/*') -and $_.Template -ne 'RedirectSite#0' } 
$m365Sites | ForEach-Object {
$siteUrl = $_.Url;     
Connect-PnPOnline -Url $siteUrl -Interactive
$ctx = Get-PnPContext
$web= Get-PnPWeb

Write-Host &quot;Processing site $siteUrl&quot;  -Foregroundcolor &quot;Red&quot;; 

#getSharingLink $ctx $web &quot;site&quot; $siteUrl &quot;&quot;;
$ll = Get-PnPList -Includes BaseType, Hidden, Title,HasUniqueRoleAssignments,RootFolder | Where-Object {$_.Hidden -eq $False -and $_.Title -notin $ExcludedLists } #$_.BaseType -eq &quot;DocumentLibrary&quot; 
  Write-Host &quot;Number of lists $($ll.Count)&quot;;

  foreach($list in $ll)
  {
    $listUrl = $list.RootFolder.ServerRelativeUrl;       

    #Get all list items in batches
    $ListItems = Get-PnPListItem -List $list -PageSize 2000 
 #   getSharingLink $ctx $list &quot;list/library&quot; $siteUrl $listUrl;
        #Iterate through each list item
        ForEach($item in $ListItems)
        {
            $ItemCount = $ListItems.Count
            #Check if the Item has unique permissions
            $HasUniquePermissions = Get-PnPProperty -ClientObject $Item -Property &quot;HasUniqueRoleAssignments&quot;
            If($HasUniquePermissions)
            {       
                #Get Shared Links
                if($list.BaseType -eq &quot;DocumentLibrary&quot;)
                {
                    $type= &quot;File&quot;;
                }
                else
                {
                    $type= &quot;Item&quot;;
                }
                getSharingLink $ctx $item $type $siteUrl $listUrl;
            }
        }
    }
 }
  $global:Results | Export-CSV $ReportOutput -NoTypeInformation
  Write-host -f Green &quot;Sharing Links Report Generated Successfully!&quot;
</code></pre>
<div class="highlight-tool">
<p>Check out the <strong>PnP PowerShell</strong> to learn more at: <a href="https://aka.ms/pnp/powershell">https://aka.ms/pnp/powershell</a></p>
</div>
</section>
</div>
<h2 id="source-credit">Source Credit</h2>
<p>Sample first appeared on <a href="https://reshmeeauckloo.com/posts/powershell-get-sharing-links-sharepoint/">Oversight of Sharing Links in SharePoint sites using PowerShell</a></p>
<h2 id="contributors">Contributors</h2>
<table>
<thead>
<tr>
<th>Author(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/reshmee011">Reshmee Auckloo</a></td>
</tr>
</tbody>
</table>
<h2 id="disclaimer">Disclaimer</h2>
<p><strong>THESE SAMPLES ARE PROVIDED <em>AS IS</em> WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, INCLUDING ANY IMPLIED WARRANTIES OF FITNESS FOR A PARTICULAR PURPOSE, MERCHANTABILITY, OR NON-INFRINGEMENT.</strong></p>
<img src="https://m365-visitor-stats.azurewebsites.net/script-samples/scripts/spo-get-sharinglinks" aria-hidden="true">

</article>
          </div>
        </div>
      </div>

      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
      <span>Script Samples<br>Generated by <strong><a href='https://dotnet.github.io/docfx' alt='Doc FX Website'>DocFX</a></strong> with Custom Theme by PnP team</span>
      
          </div>
        </div>
      </footer>
    </div>

    <script type="text/javascript" src="../styles/docfx.vendor.min.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
    <script type="text/javascript" src="../styles/main-pnp.js"></script>
  </body>
</html>